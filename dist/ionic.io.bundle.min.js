!function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return r(n?n:e)},l,l.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){!function(e,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof n?t.exports=i():e.returnExports=i()}(this,function(){function e(r,o){if("function"!=typeof o)throw new Error("Bad callback given: "+o);if(!r)throw new Error("No options given");var s=r.onResponse;if(r="string"==typeof r?{uri:r}:JSON.parse(JSON.stringify(r)),r.onResponse=s,r.verbose&&(e.log=i()),r.url&&(r.uri=r.url,delete r.url),!r.uri&&""!==r.uri)throw new Error("options.uri is a required argument");if("string"!=typeof r.uri)throw new Error("options.uri must be a string");for(var u=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],c=0;c<u.length;c++)if(r[u[c]])throw new Error("options."+u[c]+" is not supported");if(r.callback=o,r.method=r.method||"GET",r.headers=r.headers||{},r.body=r.body||null,r.timeout=r.timeout||e.DEFAULT_TIMEOUT,r.headers.host)throw new Error("Options.headers.host is not supported");r.json&&(r.headers.accept=r.headers.accept||"application/json","GET"!==r.method&&(r.headers["content-type"]="application/json"),"boolean"!=typeof r.json?r.body=JSON.stringify(r.json):"string"!=typeof r.body&&(r.body=JSON.stringify(r.body)));var l=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};if(r.qs){var f="string"==typeof r.qs?r.qs:l(r.qs);-1!==r.uri.indexOf("?")?r.uri=r.uri+"&"+f:r.uri=r.uri+"?"+f}var d=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var n=[];for(var i in e)e.hasOwnProperty(i)&&n.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+i+'"\n\n'+e[i]+"\n");return n.push("--"+t.boundry+"--"),t.body=n.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t};if(r.form){if("string"==typeof r.form)throw"form name unsupported";if("POST"===r.method){var h=(r.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(r.headers["content-type"]=h,h){case"application/x-www-form-urlencoded":r.body=l(r.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=d(r.form);r.body=p.body,r.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+h)}}}return r.onResponse=r.onResponse||n,r.onResponse===!0&&(r.onResponse=o,r.callback=n),!r.headers.authorization&&r.auth&&(r.headers.authorization="Basic "+a(r.auth.username+":"+r.auth.password)),t(r)}function t(t){function n(){f=!0;var n=new Error("ETIMEDOUT");return n.code="ETIMEDOUT",n.duration=t.timeout,e.log.error("Timeout",{id:l._id,milliseconds:t.timeout}),t.callback(n,l)}function i(n){if(f)return e.log.debug("Ignoring timed out state change",{state:l.readyState,id:l.id});if(e.log.debug("State change",{state:l.readyState,id:l.id,timed_out:f}),l.readyState===s.OPENED){e.log.debug("Request started",{id:l.id});for(var i in t.headers)l.setRequestHeader(i,t.headers[i])}else l.readyState===s.HEADERS_RECEIVED?r():l.readyState===s.LOADING?(r(),a()):l.readyState===s.DONE&&(r(),a(),u())}function r(){if(!g.response){if(g.response=!0,e.log.debug("Got response",{id:l.id,status:l.status}),clearTimeout(l.timeoutTimer),l.statusCode=l.status,d&&0==l.statusCode){var n=new Error("CORS request rejected: "+t.uri);return n.cors="rejected",g.loading=!0,g.end=!0,t.callback(n,l)}t.onResponse(null,l)}}function a(){g.loading||(g.loading=!0,e.log.debug("Response body loading",{id:l.id}))}function u(){if(!g.end){if(g.end=!0,e.log.debug("Request done",{id:l.id}),l.body=l.responseText,t.json)try{l.body=JSON.parse(l.responseText)}catch(n){return t.callback(n,l)}t.callback(null,l,l.body)}}var l=new s,f=!1,d=o(t.uri),h="withCredentials"in l;if(c+=1,l.seq_id=c,l.id=c+": "+t.method+" "+t.uri,l._id=l.id,d&&!h){var p=new Error("Browser does not support cross-origin request: "+t.uri);return p.cors="unsupported",t.callback(p,l)}l.timeoutTimer=setTimeout(n,t.timeout);var g={response:!1,loading:!1,end:!1};return l.onreadystatechange=i,l.open(t.method,t.uri,!0),d&&(l.withCredentials=!!t.withCredentials),l.send(t.body),l}function n(){}function i(){var e,t,i={},o=["trace","debug","info","warn","error"];for(t=0;t<o.length;t++)e=o[t],i[e]=n,"undefined"!=typeof console&&console&&console[e]&&(i[e]=r(console,e));return i}function r(e,t){function n(n,i){return"object"==typeof i&&(n+=" "+JSON.stringify(i)),e[t].call(e,n)}return n}function o(e){var t,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(i){t=document.createElement("a"),t.href="",t=t.href}var r=n.exec(t.toLowerCase())||[],o=n.exec(e.toLowerCase()),a=!(!o||o[1]==r[1]&&o[2]==r[2]&&(o[3]||("http:"===o[1]?80:443))==(r[3]||("http:"===r[1]?80:443)));return a}function a(e){var t,n,i,r,o,a,s,u,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,f=0,d="",h=[];if(!e)return e;do t=e.charCodeAt(l++),n=e.charCodeAt(l++),i=e.charCodeAt(l++),u=t<<16|n<<8|i,r=u>>18&63,o=u>>12&63,a=u>>6&63,s=63&u,h[f++]=c.charAt(r)+c.charAt(o)+c.charAt(a)+c.charAt(s);while(l<e.length);switch(d=h.join(""),e.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"="}return d}var s=XMLHttpRequest;if(!s)throw new Error("missing XMLHttpRequest");e.log={trace:n,debug:n,info:n,warn:n,error:n};var u=18e4,c=0;e.withCredentials=!1,e.DEFAULT_TIMEOUT=u,e.defaults=function(t,n){var i=function(e){var n=function(n,i){n="string"==typeof n?{uri:n}:JSON.parse(JSON.stringify(n));for(var r in t)void 0===n[r]&&(n[r]=t[r]);return e(n,i)};return n},r=i(e);return r.get=i(e.get),r.post=i(e.post),r.put=i(e.put),r.head=i(e.head),r};var l=["get","put","post","head"];return l.forEach(function(t){var n=t.toUpperCase(),i=t.toLowerCase();e[i]=function(t){"string"==typeof t?t={method:n,uri:t}:(t=JSON.parse(JSON.stringify(t)),t.method=n);var i=[t].concat(Array.prototype.slice.apply(arguments,[1]));return e.apply(this,i)}}),e.couch=function(t,i){function r(e,t,n){if(e)return i(e,t,n);if((t.statusCode<200||t.statusCode>299)&&n.error){e=new Error("CouchDB error: "+(n.error.reason||n.error.error));for(var r in n)e[r]=n[r];return i(e,t,n)}return i(e,t,n)}"string"==typeof t&&(t={uri:t}),t.json=!0,t.body&&(t.json=t.body),delete t.body,i=i||n;var o=e(t,r);return o},e})},{}],2:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,o=new Array(i-1),u=1;i>u;u++)o[u-1]=arguments[u];n.apply(this,o)}else if(a(n)){for(i=arguments.length,o=new Array(i-1),u=1;i>u;u++)o[u-1]=arguments[u];for(c=n.slice(),i=c.length,u=0;i>u;u++)c[u].apply(this,o)}return!0},i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned){var n;n=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var n,i,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0}},{}],3:[function(e,t,n){function i(){l=!1,s.length?c=s.concat(c):f=-1,c.length&&r()}function r(){if(!l){var e=setTimeout(i);l=!0;for(var t=c.length;t;){for(s=c,c=[];++f<t;)s&&s[f].run();f=-1,t=c.length}s=null,l=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var s,u=t.exports={},c=[],l=!1,f=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new o(e,t)),1!==c.length||l||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],4:[function(e,t,n){(function(n,i){(function(){"use strict";function r(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function a(e){V=e}function s(e){Y=e}function u(){return function(){n.nextTick(h)}}function c(){return function(){J(h)}}function l(){var e=0,t=new W(h),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function f(){var e=new MessageChannel;return e.port1.onmessage=h,function(){e.port2.postMessage(0)}}function d(){return function(){setTimeout(h,1)}}function h(){for(var e=0;B>e;e+=2){var t=te[e],n=te[e+1];t(n),te[e]=void 0,te[e+1]=void 0}B=0}function p(){try{var t=e,n=t("vertx");return J=n.runOnLoop||n.runOnContext,c()}catch(i){return d()}}function g(e,t){var n=this,i=n._state;if(i===oe&&!e||i===ae&&!t)return this;var r=new this.constructor(y),o=n._result;if(i){var a=arguments[i-1];Y(function(){A(i,r,a,o)})}else E(n,r,e,t);return r}function v(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(y);return T(n,e),n}function y(){}function _(){return new TypeError("You cannot resolve a promise with itself")}function m(){return new TypeError("A promises callback cannot return that same promise.")}function k(e){try{return e.then}catch(t){return se.error=t,se}}function b(e,t,n,i){try{e.call(t,n,i)}catch(r){return r}}function w(e,t,n){Y(function(e){var i=!1,r=b(n,t,function(n){i||(i=!0,t!==n?T(e,n):S(e,n))},function(t){i||(i=!0,j(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&r&&(i=!0,j(e,r))},e)}function P(e,t){t._state===oe?S(e,t._result):t._state===ae?j(e,t._result):E(t,void 0,function(t){T(e,t)},function(t){j(e,t)})}function I(e,t,n){t.constructor===e.constructor&&n===ne&&constructor.resolve===ie?P(e,t):n===se?j(e,se.error):void 0===n?S(e,t):o(n)?w(e,t,n):S(e,t)}function T(e,t){e===t?j(e,_()):r(t)?I(e,t,k(t)):S(e,t)}function C(e){e._onerror&&e._onerror(e._result),O(e)}function S(e,t){e._state===re&&(e._result=t,e._state=oe,0!==e._subscribers.length&&Y(O,e))}function j(e,t){e._state===re&&(e._state=ae,e._result=t,Y(C,e))}function E(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+oe]=n,r[o+ae]=i,0===o&&e._state&&Y(O,e)}function O(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i,r,o=e._result,a=0;a<t.length;a+=3)i=t[a],r=t[a+n],i?A(n,i,r,o):r(o);e._subscribers.length=0}}function R(){this.error=null}function x(e,t){try{return e(t)}catch(n){return ue.error=n,ue}}function A(e,t,n,i){var r,a,s,u,c=o(n);if(c){if(r=x(n,i),r===ue?(u=!0,a=r.error,r=null):s=!0,t===r)return void j(t,m())}else r=i,s=!0;t._state!==re||(c&&s?T(t,r):u?j(t,a):e===oe?S(t,r):e===ae&&j(t,r))}function D(e,t){try{t(function(t){T(e,t)},function(t){j(e,t)})}catch(n){j(e,n)}}function L(e){return new pe(this,e).promise}function N(e){function t(e){T(r,e)}function n(e){j(r,e)}var i=this,r=new i(y);if(!K(e))return j(r,new TypeError("You must pass an array to race.")),r;for(var o=e.length,a=0;r._state===re&&o>a;a++)E(i.resolve(e[a]),void 0,t,n);return r}function q(e){var t=this,n=new t(y);return j(n,e),n}function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function $(e){this._id=de++,this._state=void 0,this._result=void 0,this._subscribers=[],y!==e&&("function"!=typeof e&&M(),this instanceof $?D(this,e):U())}function G(e,t){this._instanceConstructor=e,this.promise=new e(y),Array.isArray(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):j(this.promise,this._validationError())}function F(){var e;if("undefined"!=typeof i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;n&&"[object Promise]"===Object.prototype.toString.call(n.resolve())&&!n.cast||(e.Promise=he)}var z;z=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var J,V,H,K=z,B=0,Y=function(e,t){te[B]=e,te[B+1]=t,B+=2,2===B&&(V?V(h):H())},X="undefined"!=typeof window?window:void 0,Q=X||{},W=Q.MutationObserver||Q.WebKitMutationObserver,Z="undefined"!=typeof n&&"[object process]"==={}.toString.call(n),ee="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,te=new Array(1e3);H=Z?u():W?l():ee?f():void 0===X&&"function"==typeof e?p():d();var ne=g,ie=v,re=void 0,oe=1,ae=2,se=new R,ue=new R,ce=L,le=N,fe=q,de=0,he=$;$.all=ce,$.race=le,$.resolve=ie,$.reject=fe,$._setScheduler=a,$._setAsap=s,$._asap=Y,$.prototype={constructor:$,then:ne,"catch":function(e){return this.then(null,e)}};var pe=G;G.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},G.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===re&&e>n;n++)this._eachEntry(t[n],n)},G.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===ie){var r=k(e);if(r===ne&&e._state!==re)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===he){var o=new n(y);I(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){t(e)}),t)}else this._willSettleAt(i(e),t)},G.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===re&&(this._remaining--,e===ae?j(i,n):this._result[t]=n),0===this._remaining&&S(i,this._result)},G.prototype._willSettleAt=function(e,t){var n=this;E(e,void 0,function(e){n._settledAt(oe,t,e)},function(e){n._settledAt(ae,t,e)})};var ge=F,ve={Promise:he,polyfill:ge};"function"==typeof define&&define.amd?define(function(){return ve}):"undefined"!=typeof t&&t.exports?t.exports=ve:"undefined"!=typeof this&&(this.ES6Promise=ve),ge()}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],5:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("../core/request"),a=e("../core/promise"),s=e("../core/settings"),u=e("../core/core"),c=e("../core/logger"),l=e("./storage"),f=e("../core/user"),d=e("../util/util"),h=new s.Settings,p=null,g="DEFER_REGISTER",v={},y={},_=[],m=function(){function e(t){i(this,e),this._dispatcher=null,this._dispatchIntervalTime=30,this._useEventCaching=!0,this._serviceHost=h.getURL("analytics"),this.logger=new c.Logger({prefix:"Ionic Analytics:"}),this.logger._silence=!0,this.storage=u.IonicPlatform.getStorage(),this.cache=new l.BucketStorage("ionic_analytics"),this._addGlobalPropertyDefaults(),t!==g&&this.register(t)}return r(e,[{key:"_addGlobalPropertyDefaults",value:function(){var e=this;e.setGlobalProperties(function(e,t){t._user=JSON.parse(JSON.stringify(f.User.current())),t._app={app_id:h.get("app_id"),analytics_version:u.IonicPlatform.Version}})}},{key:"_enqueueEvent",value:function(e,t){var n=this;if(v.dryRun)return n.logger.info("event recieved but not sent (dryRun active):"),n.logger.info(e),void n.logger.info(t);n.logger.info("enqueuing event to send later:"),n.logger.info(e),n.logger.info(t),t.keen||(t.keen={}),t.keen.timestamp=(new Date).toISOString();var i=n.cache.get("event_queue")||{};i[e]||(i[e]=[]),i[e].push(t),n.cache.set("event_queue",i)}},{key:"_requestAnalyticsKey",value:function(){var e={method:"GET",json:!0,uri:h.getURL("api")+"/api/v1/app/"+h.get("app_id")+"/keys/write",headers:{Authorization:"basic "+btoa(h.get("app_id")+":"+h.get("api_key"))}};return new o.APIRequest(e)}},{key:"_postEvent",value:function(e,t){var n=this,i={name:[t]};p||n.logger.error("Cannot send events to the analytics server without an Analytics key.");var r={method:"POST",url:n._serviceHost+"/api/v1/events/"+h.get("app_id"),body:i,json:!0,headers:{Authorization:p}};return new o.APIRequest(r)}},{key:"_postEvents",value:function(e){var t=this;p||t.logger.info("Cannot send events to the analytics server without an Analytics key.");var n={method:"POST",url:t._serviceHost+"/api/v1/events/"+h.get("app_id"),body:e,json:!0,headers:{Authorization:p}};return new o.APIRequest(n)}},{key:"_dispatchQueue",value:function(){var e=this,t=this.cache.get("event_queue")||{};0!==Object.keys(t).length&&u.IonicPlatform.deviceConnectedToNetwork()&&e.storage.lockedAsyncCall(e.cache.scopedKey("event_dispatch"),function(){return e._postEvents(t)}).then(function(){e.cache.set("event_queue",{}),e.logger.info("sent events"),e.logger.info(t)},function(n){e._handleDispatchError(n,this,t)})}},{key:"_getRequestStatusCode",value:function(e){var t=!1;return e&&e.requestInfo._lastResponse&&e.requestInfo._lastResponse.statusCode&&(t=e.requestInfo._lastResponse.statusCode),t}},{key:"_handleDispatchError",value:function(e,t,n){var i=this,r=this._getRequestStatusCode(t);"last_call_interrupted"===e?i.cache.set("event_queue",{}):r?(i.cache.set("event_queue",{}),i.logger.error("Error sending analytics data: Server responded with error"),i.logger.error(n)):i.logger.error("Error sending analytics data: Failed to connect to analytics server.")}},{key:"_handleRegisterError",value:function(e,t){var n=this._getRequestStatusCode(t),i=" See http://docs.ionic.io/v1.0/docs/io-quick-start";switch(n){case 401:self.logger.error("The api key and app id you provided did not register on the server. "+i);break;case 404:self.logger.error('The app id you provided ("'+h.get("app_id")+'") was not found.'+i);break;default:self.logger.error("Unable to request analytics key."),self.logger.error(e)}}},{key:"register",value:function(e){var t=this,n=new a.DeferredPromise;return this.hasValidSettings?(v=e||{},v.silent?this.logger._silence=!0:this.logger._silence=!1,v.dryRun&&this.logger.info("dryRun mode is active. Analytics will not send any events."),this._requestAnalyticsKey().then(function(e){p=e.payload.write_key,t.logger.info("successfully registered analytics key"),t.dispatchInterval=t.dispatchInterval,n.resolve(!0)},function(e){t._handleRegisterError(e,this),n.reject(!1)}),n.promise):(n.reject(!1),n.promise)}},{key:"setGlobalProperties",value:function(e){var t=this,n=typeof e;switch(n){case"object":for(var i in e)e.hasOwnProperty(i)&&(y[i]=e[i]);break;case"function":_.push(e);break;default:t.logger.error("setGlobalProperties parameter must be an object or function.")}}},{key:"track",value:function(e,t){var n=this;if(!this.hasValidSettings)return!1;t=t?(0,d.deepExtend)({},t):{};for(var i in y)y.hasOwnProperty(i)&&void 0===t[i]&&(t[i]=y[i]);for(var r=0;r<_.length;r++){var o=_[r];o.call(null,e,t)}this._useEventCaching?n._enqueueEvent(e,t):v.dryRun?(n.logger.info("dryRun active, will not send event"),n.logger.info(e),n.logger.info(t)):n._postEvent(e,t)}},{key:"unsetGlobalProperty",value:function(e){var t=this,n=typeof e;switch(n){case"string":delete y[e];break;case"function":var i=_.indexOf(e);-1===i&&t.logger.error("The function passed to unsetGlobalProperty was not a global property."),_.splice(i,1);break;default:t.logger.error("unsetGlobalProperty parameter must be a string or function.")}}},{key:"hasValidSettings",get:function(){if(!h.get("app_id")||!h.get("api_key")){var e="A valid app_id and api_key are required before you can utilize analytics properly. See http://docs.ionic.io/v1.0/docs/io-quick-start";return this.logger.info(e),!1}return!0}},{key:"dispatchInterval",set:function(e){var t=this;this._dispatchIntervalTime=e,this._dispatcher&&window.clearInterval(this.dispatcher),e>0?(this._dispatcher=window.setInterval(function(){t._dispatchQueue()},1e3*e),this._useEventCaching=!0):this._useEventCaching=!1},get:function(){return this._dispatchIntervalTime}}]),e}();n.Analytics=m},{"../core/core":12,"../core/logger":16,"../core/promise":17,"../core/request":18,"../core/settings":19,"../core/user":21,"../util/util":34,"./storage":9}],6:[function(e,t,n){"use strict";if("object"==typeof angular&&angular.module){var i=function(e){return["$ionicAnalytics","$ionicGesture",function(t,n){for(var i=["drag","dragstart","dragend","dragleft","dragright","dragup","dragdown","swipe","swipeleft","swiperight","swipeup","swipedown","tap","doubletap","hold","transform","pinch","pinchin","pinchout","rotate"],r=!1,o=0;o<i.length;o++)i[o]===e.toLowerCase()&&(r=!0);return{restrict:"A",link:function(i,o,a){function s(e){var n=i.$eval(a.ionTrackData)||{};c?t.track(c,n):t.trackClick(e.pageX,e.pageY,e.target,{data:n})}var u=e[0].toUpperCase()+e.slice(1),c=a["ionTrack"+u];if(r){var l=n.on(e,s,o);i.$on("$destroy",function(){n.off(l,e,s)})}else o.on(e,s),i.$on("$destroy",function(){o.off(e,s)})}}}]},r=null;angular.module("ionic.service.analytics",["ionic"]).value("IONIC_ANALYTICS_VERSION",Ionic.Analytics.version).factory("$ionicAnalytics",[function(){return r||(r=new Ionic.Analytics("DEFER_REGISTER")),r}]).factory("domSerializer",[function(){return new Ionic.AnalyticSerializers.DOMSerializer}]).run(["$ionicAnalytics","$state",function(e,t){e.setGlobalProperties(function(e,n){n._ui||(n._ui={}),n._ui.active_state=t.current.name})}]),angular.module("ionic.service.analytics").provider("$ionicAutoTrack",[function(){var e={},t=!1;this.disableTracking=function(n){n?e[n]=!0:t=!0},this.$get=[function(){return{isEnabled:function(n){return!t&&!e[n]}}}]}]).run(["$ionicAutoTrack","$ionicAnalytics",function(e,t){e.isEnabled("Load")&&t.track("Load")}]).run(["$ionicAutoTrack","$document","$ionicAnalytics","domSerializer",function(e,t,n,i){e.isEnabled("Tap")&&t.on("click",function(e){var t=e.target.getBoundingClientRect(),r=t.right-t.left,o=t.bottom-t.top,a=(e.pageX-t.left)/r,s=(e.pageY-t.top)/o,u={coordinates:{x:e.pageX,y:e.pageY},target:i.elementSelector(e.target),target_identifier:i.elementName(e.target)};isFinite(a)&&isFinite(s)&&(u.coordinates.x_norm=a,u.coordinates.y_norm=s),n.track("Tap",{_ui:u})})}]).run(["$ionicAutoTrack","$ionicAnalytics","$rootScope",function(e,t,n){e.isEnabled("State Change")&&n.$on("$stateChangeSuccess",function(e,n,i,r,o){t.track("State Change",{from:r.name,to:n.name})})}]).directive("ionTrackClick",i("click")).directive("ionTrackTap",i("tap")).directive("ionTrackDoubletap",i("doubletap")).directive("ionTrackHold",i("hold")).directive("ionTrackRelease",i("release")).directive("ionTrackDrag",i("drag")).directive("ionTrackDragLeft",i("dragleft")).directive("ionTrackDragRight",i("dragright")).directive("ionTrackDragUp",i("dragup")).directive("ionTrackDragDown",i("dragdown")).directive("ionTrackSwipeLeft",i("swipeleft")).directive("ionTrackSwipeRight",i("swiperight")).directive("ionTrackSwipeUp",i("swipeup")).directive("ionTrackSwipeDown",i("swipedown")).directive("ionTrackTransform",i("hold")).directive("ionTrackPinch",i("pinch")).directive("ionTrackPinchIn",i("pinchin")).directive("ionTrackPinchOut",i("pinchout")).directive("ionTrackRotate",i("rotate"))}},{}],7:[function(e,t,n){"use strict";var i=e("./analytics"),r=e("./storage"),o=e("./serializers");window.Ionic=window.Ionic||{},Ionic.Analytics=i.Analytics,Ionic.AnalyticStorage={},Ionic.AnalyticStorage.BucketStorage=r.BucketStorage,Ionic.AnalyticSerializers={},Ionic.AnalyticSerializers.DOMSerializer=o.DOMSerializer},{"./analytics":5,"./serializers":8,"./storage":9}],8:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e)}return r(e,[{key:"elementSelector",value:function(e){for(var t=[];"HTML"!==e.tagName;){var n=e.tagName.toLowerCase(),i=e.getAttribute("id");i&&(n+="#"+i);var r=e.className;if(r)for(var o=r.split(" "),a=0;a<o.length;a++){var s=o[a];s&&(n+="."+s)}if(!e.parentNode)return null;var u=Array.prototype.indexOf.call(e.parentNode.children,e);n+=":nth-child("+(u+1)+")",e=e.parentNode,t.push(n)}return t.reverse().join(">")}},{key:"elementName",value:function(e){var t=e.getAttribute("ion-track-name");if(t)return t;var n=e.getAttribute("id");return n?n:null}}]),e}();n.DOMSerializer=o},{}],9:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("../core/settings"),a=e("../core/core"),s=new o.Settings,u=function(){function e(t){i(this,e),this.name=t,this.baseStorage=a.IonicPlatform.getStorage()}return r(e,[{key:"get",value:function(e){return this.baseStorage.retrieveObject(this.scopedKey(e))}},{key:"set",value:function(e,t){return this.baseStorage.storeObject(this.scopedKey(e),t)}},{key:"scopedKey",value:function(e){return this.name+"_"+e+"_"+s.get("app_id")}}]),e}();n.BucketStorage=u},{"../core/core":12,"../core/settings":19}],10:[function(e,t,n){"use strict";"object"==typeof angular&&angular.module&&angular.module("ionic.service.core",[]).provider("persistentStorage",function(){return{$get:[function(){var e=Ionic.getService("Storage");return e||(e=new Ionic.IO.Storage,Ionic.addService("Storage",e,!0)),e}]}}).factory("$ionicCoreSettings",[function(){return new Ionic.IO.Settings}]).factory("$ionicUser",[function(){return Ionic.User}]).run([function(){Ionic.io()}])},{}],11:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e){return s[e]||null}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("./logger"),s={},u=function(){function e(t,n){return i(this,e),this.logger=new a.Logger({prefix:"Ionic App:"}),t&&""!==t?n&&""!==n?(s.id=t,s.apiKey=n,this.devPush=null,void(this.gcmKey=null)):(this.logger.info("No api_key was provided"),!1):(this.logger.info("No app_id was provided"),!1)}return o(e,[{key:"toString",value:function(){return"<IonicApp ['"+this.id+"'>"}},{key:"id",get:function(){return r("id")}},{key:"apiKey",get:function(){return r("apiKey")}}]),e}();n.App=u},{"./logger":16}],12:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./events"),a=e("./storage"),s=e("./logger"),u=new o.EventEmitter,c=new a.Storage,l=function(){function e(){i(this,e);var t=this;if(this.logger=new s.Logger({prefix:"Ionic Core:"}),this.logger.info("init"),this._pluginsReady=!1,this.emitter=e.getEmitter(),this._bootstrap(),t.cordovaPlatformUnknown)t.logger.info("attempting to mock plugins"),t._pluginsReady=!0,t.emitter.emit("ionic_core:plugins_ready");else try{document.addEventListener("deviceready",function(){t.logger.info("plugins are ready"),t._pluginsReady=!0,t.emitter.emit("ionic_core:plugins_ready")},!1)}catch(n){t.logger.info("unable to listen for cordova plugins to be ready")}}return r(e,[{key:"_isCordovaAvailable",value:function(){var e=this;if(this.logger.info("searching for cordova.js"),"undefined"!=typeof cordova)return this.logger.info("cordova.js has already been loaded"),!0;for(var t=document.getElementsByTagName("script"),n=t.length,i=0;n>i;i++){var r=t[i].getAttribute("src");if(r){var o=r.split("/"),a=0;try{if(a=o.length,"cordova.js"===o[a-1])return e.logger.info("cordova.js has previously been included."),!0}catch(s){e.logger.info("encountered error while testing for cordova.js presence, "+s.toString())}}}return!1}},{key:"loadCordova",value:function(){var t=this;if(!this._isCordovaAvailable()){var n=document.createElement("script"),i="cordova.js";switch(e.getDeviceTypeByNavigator()){
case"android":"file"===window.location.href.substring(0,4)&&(i="file:///android_asset/www/cordova.js");break;case"ipad":case"iphone":try{var r=window.location.search.match(/cordova_js_bootstrap_resource=(.*?)(&|#|$)/i);r&&(i=decodeURI(r[1]))}catch(o){t.logger.info("could not find cordova_js_bootstrap_resource query param"),t.logger.info(o)}break;case"unknown":return t.cordovaPlatformUnknown=!0,!1}n.setAttribute("src",i),document.head.appendChild(n),t.logger.info("injecting cordova.js")}}},{key:"_bootstrap",value:function(){this.loadCordova()}},{key:"onReady",value:function(e){var t=this;this._pluginsReady?e(t):t.emitter.on("ionic_core:plugins_ready",function(){e(t)})}}],[{key:"getEmitter",value:function(){return u}},{key:"getStorage",value:function(){return c}},{key:"getMain",value:function(){return"undefined"!=typeof Ionic&&Ionic.IO&&Ionic.IO.main?Ionic.IO.main:null}},{key:"getDeviceTypeByNavigator",value:function(){var e=navigator.userAgent,t=e.match(/iPad/i);if(t&&"ipad"===t[0].toLowerCase())return"ipad";var n=e.match(/iPhone/i);if(n&&"iphone"===n[0].toLowerCase())return"iphone";var i=e.match(/Android/i);return i&&"android"===i[0].toLowerCase()?"android":"unknown"}},{key:"isAndroidDevice",value:function(){var t=e.getDeviceTypeByNavigator();return"android"===t}},{key:"isIOSDevice",value:function(){var t=e.getDeviceTypeByNavigator();return"iphone"===t||"ipad"===t}},{key:"deviceConnectedToNetwork",value:function(e){if("undefined"==typeof e&&(e=!1),"undefined"==typeof navigator.connection||"undefined"==typeof navigator.connection.type||"undefined"==typeof Connection)return!e;switch(navigator.connection.type){case Connection.ETHERNET:case Connection.WIFI:case Connection.CELL_2G:case Connection.CELL_3G:case Connection.CELL_4G:case Connection.CELL:return!0;default:return!1}}},{key:"Version",get:function(){return"0.2.1"}}]),e}();n.IonicPlatform=l},{"./events":15,"./logger":16,"./storage":20}],13:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o={},a=function(){function e(t){i(this,e),this.data={},this.setProperties(t)}return r(e,[{key:"setProperties",value:function(e){if(e instanceof Object)for(var t in e)this.data[t]=e[t]}},{key:"toJSON",value:function(){var e=this.data;return{__Ionic_DataTypeSchema:e.name,value:e.value}}},{key:"isValid",value:function(){return!(!this.data.name||!this.data.value)}}]),e}(),s=function(){function e(){i(this,e)}return r(e,null,[{key:"get",value:function(e,t){return o[e]?new o[e](t):!1}},{key:"getMapping",value:function(){return o}},{key:"register",value:function(e,t){o[e]=t}},{key:"Schema",get:function(){return a}}]),e}();n.DataType=s;var u=function(){function e(t){if(i(this,e),this.data=[],t instanceof Array)for(var n in t)this.push(t[n])}return r(e,[{key:"toJSON",value:function(){var e=this.data,t=new a({name:"UniqueArray",value:e});return t.toJSON()}},{key:"push",value:function(e){-1===this.data.indexOf(e)&&this.data.push(e)}},{key:"pull",value:function(e){var t=this.data.indexOf(e);this.data.splice(t,1)}}],[{key:"fromStorage",value:function(t){return new e(t)}}]),e}();n.UniqueArray=u,s.register("UniqueArray",u)},{}],14:[function(e,t,n){"use strict";var i=e("./app"),r=e("./core"),o=e("./events"),a=e("./logger"),s=e("./promise"),u=e("./request"),c=e("./settings"),l=e("./storage"),f=e("./user"),d=e("./data-types");window.Ionic=window.Ionic||{},Ionic.Core=r.IonicPlatform,Ionic.User=f.User,Ionic.DataType=d.DataType,Ionic.DataTypes=d.DataType.getMapping(),Ionic.IO={},Ionic.IO.App=i.App,Ionic.IO.EventEmitter=o.EventEmitter,Ionic.IO.Logger=a.Logger,Ionic.IO.Promise=s.Promise,Ionic.IO.DeferredPromise=s.DeferredPromise,Ionic.IO.Request=u.Request,Ionic.IO.Response=u.Response,Ionic.IO.APIRequest=u.APIRequest,Ionic.IO.APIResponse=u.APIResponse,Ionic.IO.Storage=l.Storage,Ionic.IO.Settings=c.Settings;var h={};Ionic.io=function(){return"undefined"==typeof Ionic.IO.main&&(Ionic.IO.main=new Ionic.Core),Ionic.IO.main},Ionic.getService=function(e){return"undefined"!=typeof h[e]&&h[e]?h[e]:!1},Ionic.addService=function(e,t,n){t&&"undefined"==typeof h[e]?h[e]=t:t&&n&&(h[e]=t)},Ionic.removeService=function(e){"undefined"!=typeof h[e]&&delete h[e]},Ionic.io()},{"./app":11,"./core":12,"./data-types":13,"./events":15,"./logger":16,"./promise":17,"./request":18,"./settings":19,"./storage":20,"./user":21}],15:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("events"),a=function(){function e(){i(this,e),this._emitter=new o}return r(e,[{key:"on",value:function(e,t){return this._emitter.on(e,t)}},{key:"emit",value:function(e,t){return this._emitter.emit(e,t)}}]),e}();n.EventEmitter=a},{events:2}],16:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e);var n=t||{};this._silence=!1,this._prefix=!1,this._options=n,this._bootstrap()}return r(e,[{key:"_bootstrap",value:function(){this._options.prefix&&(this._prefix=this._options.prefix)}},{key:"info",value:function(e){this._silence||(this._prefix?console.log(this._prefix,e):console.log(e))}},{key:"warn",value:function(e){this._silence||(this._prefix?console.log(this._prefix,e):console.log(e))}},{key:"error",value:function(e){this._prefix?console.error(this._prefix,e):console.error(e)}}]),e}();n.Logger=o},{}],17:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("es6-promise").Promise,a=o;n.Promise=a;var s=function(){function e(){i(this,e);var t=this;this._update=!1,this.promise=new o(function(e,n){t.resolve=e,t.reject=n});var n=this.promise.then;this.promise.then=function(e,i,r){return t._update=r,n.call(t.promise,e,i)}}return r(e,[{key:"notify",value:function(e){this._update&&"function"==typeof this._update&&this._update(e)}}]),e}();n.DeferredPromise=s},{"es6-promise":4}],18:[function(e,t,n){"use strict";function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(e,t,n){for(var i=!0;i;){var r=e,o=t,a=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var c=Object.getPrototypeOf(r);if(null===c)return;e=c,t=o,n=a,i=!0,s=c=void 0}},a=e("./promise"),s=e("browser-request"),u=function d(){r(this,d)};n.Request=u;var c=function h(){r(this,h)};n.Response=c;var l=function(e){function t(){r(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this)}return i(t,e),t}(c);n.APIResponse=l;var f=function(e){function t(e){r(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var n={},i=new a.Promise(function(t,i){s(e,function(e,r,o){if(n._lastError=e,n._lastResponse=r,n._lastResult=o,e)i(e);else if(r.statusCode<200||r.statusCode>=400){var a=new Error("Request Failed with status code of "+r.statusCode);i(a)}else t({response:r,payload:o})})});return i.requestInfo=n,i}return i(t,e),t}(u);n.APIRequest=f},{"./promise":17,"browser-request":1}],19:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){return i(this,e),this._settings=null,this}return r(e,[{key:"factory",value:function(e,t){return this._settings=t(),this}},{key:"get",value:function(e){return this._settings.get(e)}},{key:"finish",value:function(){return this}}]),e}(),a=(new o).factory("$ionicCoreSettings",function(){"IONIC_SETTINGS_STRING_START";"IONIC_SETTINGS_STRING_END"}).finish(),s=function(){function e(){i(this,e),this._locations={api:"https://apps.ionic.io",push:"https://push.ionic.io",analytics:"https://analytics.ionic.io",deploy:"https://apps.ionic.io"},this._devLocations=this.get("dev_locations"),this._devLocations||(this._devLocations={})}return r(e,[{key:"get",value:function(e){return a.get(e)}},{key:"getURL",value:function(e){return this._devLocations[e]?this._devLocations[e]:this._locations[e]?this._locations[e]:null}}]),e}();n.Settings=s},{}],20:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./promise"),a=function(){function e(){i(this,e)}return r(e,[{key:"get",value:function(e){return window.localStorage.getItem(e)}},{key:"remove",value:function(e){return window.localStorage.removeItem(e)}},{key:"set",value:function(e,t){return window.localStorage.setItem(e,t)}}]),e}(),s={},u={},c=function(){function e(){i(this,e),this.strategy=new a}return r(e,[{key:"storeObject",value:function(e,t){var n=JSON.stringify(t);this.strategy.set(e,n),s[e]=t}},{key:"deleteObject",value:function(e){this.strategy.remove(e),delete s[e]}},{key:"retrieveObject",value:function(e){var t=s[e];if(t)return t;var n=this.strategy.get(e);if(null===n)return null;try{return JSON.parse(n)}catch(i){return null}}},{key:"lockedAsyncCall",value:function(e,t){var n=this,i=new o.DeferredPromise;return u[e]?(i.reject("in_progress"),i.promise):"locked"===this.strategy.get(e)?(i.reject("last_call_interrupted"),i.promise.then(null,function(){n.strategy.remove(e)}),i.promise):(u[e]=!0,n.strategy.set(e,"locked"),t().then(function(t){i.resolve(t),delete u[e],n.strategy.remove(e)},function(t){i.reject(t),delete u[e],n.strategy.remove(e)},function(e){i.notify(e)}),i.promise)}}]),e}();n.Storage=c},{"./promise":17}],21:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./request"),a=e("./promise"),s=e("./settings"),u=e("./core"),c=e("./storage"),l=e("./logger"),f=e("../push/push-token"),d=e("./data-types.js"),h=u.IonicPlatform,p=null,g=new s.Settings,v=new c.Storage,y=g.getURL("api")+"/api/v1/app/"+g.get("app_id")+"/users",_={load:function(e){return y+"/"+e.id},remove:function(e){return y+"/"+e.id},save:function(e){return y+"/"+e.id},identify:function(){return y+"/identify"},addToken:function(){return y+"/pushUnique"}},m=function(){function e(){i(this,e)}return r(e,null,[{key:"delete",value:function(){v.deleteObject(e.label)}},{key:"store",value:function(){v.storeObject(e.label,w.current())}},{key:"getRawData",value:function(){return v.retrieveObject(e.label)||!1}},{key:"load",value:function(){var t=v.retrieveObject(e.label)||!1;return t?w.fromContext(t):!1}},{key:"label",get:function(){return"ionic_io_user_"+g.get("app_id")}}]),e}(),k=function(){function e(t){i(this,e),this.logger=new l.Logger({prefix:"Ionic Push Token:"}),this.tokens={android:[],ios:[]},t&&"object"==typeof t&&(this.tokens=t)}return r(e,[{key:"addToken",value:function(e){var t=null;if("undefined"==typeof e||!e||""===e)return this.logger.info("you need to pass a valid token to addToken()"),!1;if(e.token&&(e=e.token),"DEV"===e.slice(0,3))return this.logger.info("dev tokens cannot be saved to a user as they are a temporary resource"),!1;if(h.isAndroidDevice()?t="android":h.isIOSDevice()&&(t="ios"),null===t||!this.tokens.hasOwnProperty(t))return this.logger.info("cannot determine the token platform. Are you running on an Android or iOS device?"),!1;var n=this.tokens[t],i=!1,r=null;for(r in n)n[r]===e&&(i=!0);return i||n.push(e),!0}},{key:"removeToken",value:function(e){var t;for(t in this.tokens){var n,i=this.tokens[t];for(n in i)i[n]===e.token&&i.splice(n,1)}return!0}}]),e}(),b=function(){function e(t){i(this,e),this.data={},"object"==typeof t&&(this.data=t,this.deserializerDataTypes())}return r(e,[{key:"deserializerDataTypes",value:function(){for(var e in this.data)if("object"==typeof this.data[e]&&this.data[e].__Ionic_DataTypeSchema){var t=this.data[e].__Ionic_DataTypeSchema,n=d.DataType.getMapping();n[t]&&(this.data[e]=n[t].fromStorage(this.data[e].value))}}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"unset",value:function(e){delete this.data[e]}},{key:"get",value:function(e,t){return this.data.hasOwnProperty(e)?this.data[e]:t||null}}]),e}(),w=function(){function e(){i(this,e),this.logger=new l.Logger({prefix:"Ionic User:"}),this._blockLoad=!1,this._blockSave=!1,this._blockDelete=!1,this._dirty=!1,this._fresh=!0,this._unset={},this.push=new k,this.data=new b}return r(e,[{key:"isDirty",value:function(){return this._dirty}},{key:"isFresh",value:function(){return this._fresh}},{key:"isValid",value:function(){return!!this.id}},{key:"getAPIFormat",value:function(){var e=this,t=this.data.data;return t.user_id=this.id,t._push={android_tokens:this.push.tokens.android,ios_tokens:this.push.tokens.ios},this.isFresh()?t:{update:t,remove:e._unset}}},{key:"getFormat",value:function(e){var t=this,n=null;switch(e){case"api":n=t.getAPIFormat()}return n}},{key:"delete",value:function(){var e=this,t=new a.DeferredPromise;return e.isValid()?(e._blockDelete?(e.logger.info("a delete operation is already in progress for "+this+"."),t.reject(!1)):(e._blockDelete=!0,e._delete(),new o.APIRequest({uri:_.remove(this),method:"DELETE",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(n){e._blockDelete=!1,e.logger.info("deleted "+e),t.resolve(n)},function(n){e._blockDelete=!1,e.logger.error(n),t.reject(n)})),t.promise):!1}},{key:"_store",value:function(){this===e.current()&&m.store()}},{key:"_delete",value:function(){this===e.current()&&m["delete"]()}},{key:"save",value:function(){var e=this,t=new a.DeferredPromise;if(e._blockSave)e.logger.info("a save operation is already in progress for "+this+"."),t.reject(!1);else{e._blockSave=!0,e._store();var n=_.save(this),i="PUT";e.isFresh()&&(n=_.identify(this),i="POST"),new o.APIRequest({uri:n,method:i,headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e.getFormat("api"))}).then(function(n){e._dirty=!1,e.isFresh()||(e._unset={}),e._fresh=!1,e._blockSave=!1,e.logger.info("saved user"),t.resolve(n)},function(n){e._dirty=!0,e._blockSave=!1,e.logger.error(n),t.reject(n)})}return t.promise}},{key:"toString",value:function(){return"<IonicUser ['"+this.id+"']>"}},{key:"addPushToken",value:function(e){return this.push.addToken(e)}},{key:"removePushToken",value:function(e){return e instanceof f.PushToken||(e=new f.PushToken(e)),this.push.removeToken(e)}},{key:"set",value:function(e,t){return delete this._unset[e],this.data.set(e,t)}},{key:"get",value:function(e,t){return this.data.get(e,t)}},{key:"unset",value:function(e){return this._unset[e]=!0,this.data.unset(e)}},{key:"id",set:function(e){return e&&"string"==typeof e&&""!==e?(this._id=e,!0):!1},get:function(){return this._id||null}}],[{key:"current",value:function(t){return t?(p=t,m.store(),p):(p||(p=m.load()),p||(p=new e),p)}},{key:"fromContext",value:function(t){var n=new e;return n.id=t._id,n.data=new b(t.data.data),n.push=new k(t.push.tokens),n._fresh=t._fresh,n._dirty=t._dirty,n}},{key:"load",value:function(t){var n=new a.DeferredPromise,i=new e;return i.id=t,i._blockLoad?(i.logger.info("a load operation is already in progress for "+this+"."),n.reject(!1)):(i._blockLoad=!0,new o.APIRequest({uri:_.load(i),method:"GET",json:!0,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){i._blockLoad=!1,i.logger.info("loaded user"),i.data=new b(e.payload.custom_data),e.payload._push&&e.payload._push.android_tokens&&(i.push.tokens.android=e.payload._push.android_tokens),e.payload._push&&e.payload._push.ios_tokens&&(i.push.tokens.ios=e.payload._push.ios_tokens),i.image=e.payload.image,i._fresh=!1,n.resolve(i)},function(e){i._blockLoad=!1,i.logger.error(e),n.reject(e)})),n.promise}},{key:"anonymousId",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}}]),e}();n.User=w},{"../push/push-token":32,"./core":12,"./data-types.js":13,"./logger":16,"./promise":17,"./request":18,"./settings":19,"./storage":20}],22:[function(e,t,n){"use strict";if("object"==typeof angular&&angular.module){var i=null;angular.module("ionic.service.deploy",[]).factory("$ionicDeploy",[function(){return i||(i=new Ionic.Deploy),i}])}},{}],23:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("../core/settings"),a=e("../core/promise"),s=e("../core/logger"),u=e("../core/core"),c=e("../core/events"),l=new o.Settings,f="IONIC_DEPLOY_MISSING_PLUGIN",d=5e3,h=6e4,p=function(){function e(){i(this,e);var t=this;this.logger=new s.Logger({prefix:"Ionic Deploy:"}),this._plugin=!1,this._isReady=!1,this._channelTag="production",this._emitter=new c.EventEmitter,this.logger.info("init"),u.IonicPlatform.getMain().onReady(function(){t.initialize(),t._isReady=!0,t._emitter.emit("ionic_deploy:ready")})}return r(e,[{key:"_getPlugin",value:function(){return this._plugin?this._plugin:"undefined"==typeof IonicDeploy?(this.logger.info("plugin is not installed or has not loaded. Have you run `ionic plugin add ionic-plugin-deploy` yet?"),!1):(this._plugin=IonicDeploy,IonicDeploy)}},{key:"initialize",value:function(){var e=this;this.onReady(function(){e._getPlugin()&&e._plugin.init(l.get("app_id"),l.getURL("deploy"))})}},{key:"check",value:function(){var e=this,t=new a.DeferredPromise;return this.onReady(function(){e._getPlugin()?e._plugin.check(l.get("app_id"),e._channelTag,function(n){n&&"true"===n?(e.logger.info("an update is available"),t.resolve(!0)):(e.logger.info("no updates available"),t.resolve(!1))},function(n){e.logger.error("encountered an error while checking for updates"),t.reject(n)}):t.reject(f)}),t.promise}},{key:"download",value:function(){var e=this,t=new a.DeferredPromise;return this.onReady(function(){e._getPlugin()?e._plugin.download(l.get("app_id"),function(n){"true"!==n&&"false"!==n?t.notify(n):("true"===n&&e.logger.info("download complete"),t.resolve("true"===n))},function(e){t.reject(e)}):t.reject(f)}),t.promise}},{key:"extract",value:function(){var e=this,t=new a.DeferredPromise;return this.onReady(function(){e._getPlugin()?e._plugin.extract(l.get("app_id"),function(n){"done"!==n?t.notify(n):("true"===n&&e.logger.info("extraction complete"),t.resolve(n))},function(e){t.reject(e)}):t.reject(f)}),t.promise}},{key:"load",value:function(){var e=this;this.onReady(function(){e._getPlugin()&&e._plugin.redirect(l.get("app_id"))})}},{key:"watch",value:function(e){function t(){r.check().then(function(e){e&&n.notify(e)},function(e){r.logger.info("unable to check for updates, ",e)}),this._checkTimeout&&(this._checkTimeout=setTimeout(t.bind(r),i.interval))}var n=new a.DeferredPromise,i=e||{},r=this;return"undefined"==typeof i.initialDelay&&(i.initialDelay=d),"undefined"==typeof i.interval&&(i.interval=h),this._checkTimeout=setTimeout(t.bind(r),i.initialDelay),n.promise}},{key:"unwatch",value:function(){clearTimeout(this._checkTimeout),this._checkTimeout=null}},{key:"info",value:function(){var e=new a.DeferredPromise,t=this;return this.onReady(function(){t._getPlugin()?t._plugin.info(l.get("app_id"),function(t){e.resolve(t)},function(t){e.reject(t)}):e.reject(f)}),e.promise}},{key:"getVersions",value:function(){var e=new a.DeferredPromise,t=this;return this.onReady(function(){t._getPlugin()?t._plugin.getVersions(l.get("app_id"),function(t){e.resolve(t)},function(t){e.reject(t)}):e.reject(f)}),e.promise}},{key:"deleteVersion",value:function(e){var t=new a.DeferredPromise,n=this;return this.onReady(function(){n._getPlugin()?n._plugin.deleteVersion(l.get("app_id"),e,function(e){t.resolve(e)},function(e){t.reject(e)}):t.reject(f)}),t.promise}},{key:"getMetadata",value:function(e){var t=new a.DeferredPromise,n=this;return this.onReady(function(){n._getPlugin()?n._plugin.getMetadata(l.get("app_id"),e,function(e){t.resolve(e.metadata)},function(e){t.reject(e)}):t.reject(f)}),t.promise}},{key:"setChannel",value:function(e){this._channelTag=e}},{key:"update",value:function(e){var t=new a.DeferredPromise,n=this,i=!1;return"undefined"!=typeof e&&(i=e),this.onReady(function(){n._getPlugin()?n.check().then(function(e){if(e===!0){var r=0;n.download().then(function(e){e||t.reject("download error"),n.extract().then(function(e){e||t.reject("extraction error"),i?t.resolve(!0):(t.resolve(!0),n._plugin.redirect(l.get("app_id")))},function(e){t.reject(e)},function(e){var n=r+e/2;t.notify(n)})},function(e){t.reject(e)},function(e){r=e/2,t.notify(r)})}else t.resolve(!1)},function(e){t.reject(e)}):t.reject(f)}),t.promise}},{key:"onReady",value:function(e){var t=this;this._isReady?e(t):t._emitter.on("ionic_deploy:ready",function(){e(t)})}}]),e}();n.Deploy=p},{"../core/core":12,"../core/events":15,"../core/logger":16,"../core/promise":17,"../core/settings":19}],24:[function(e,t,n){"use strict";var i=e("./deploy");window.Ionic=window.Ionic||{},Ionic.Deploy=i.Deploy},{"./deploy":23}],25:[function(e,t,n){"use strict";"object"==typeof angular&&angular.module&&angular.module("ionic.service.pages",[]).provider("$ionicPages",["$stateProvider",function(e){console.log("GETTING",e);var t=new Ionic.Pages;t.initialize(),t._$stateProvider=e,this.$get=[function(){return t}]}]).run(["$ionicPages","$compile","$rootScope",function(e,t,n){var i=e.fetchPages();i.then(function(i){console.log("LOADED PAGES",i);for(var r=void 0,o=0;o<i.length;o++){r=i[o],console.log(r);var a='<script id="about-page.html" type="text/ng-template">\n        <style>'+r.css+"</style>\n\n        "+r.html+"\n\n        </script>",s=t(a)(n);angular.element(document.body).append(s);var u=r.stateConfig;console.log("Registering new state",u.state,u.url,u.templateUrl),e._$stateProvider.state(u.state,{url:u.url,templateUrl:u.templateUrl})}})["catch"](function(e){console.error("Unable to load dynamic Ionic Pages",e)})}])},{}],26:[function(e,t,n){"use strict";var i=e("./pages");window.Ionic=window.Ionic||{},Ionic.Pages=i.Pages},{"./pages":27}],27:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("../core/promise"),a=e("../core/logger"),s=e("../core/core"),u=function(){function e(){i(this,e);var t=this;this.logger=new a.Logger({prefix:"Ionic Pages:"}),t._isReady=!1,this.logger.info("init"),s.IonicPlatform.getMain().onReady(function(){t.initialize(),t._isReady=!0,t._emitter.emit("ionic_pages:ready")})}return r(e,[{key:"initialize",value:function(){}},{key:"fetchPages",value:function(){var e=new o.DeferredPromise;return setTimeout(function(){e.resolve([{stateConfig:{state:"about",url:"/about",templateUrl:"about-page.html"},html:'\n          <ion-view view-title="Dynamic Page">\n            <ion-content class="padding">\n              <h2>This is a dynamic page!</h2>\n              <p>\n                How cool is this shit?\n              </p>\n              <div class="custom-thing">\n                This is a custom thing. How darn cool?\n              </div>\n              <button ng-click="doClicker()" class="button button-primary">Click me, I dare ya!</button>\n            </ion-content>\n          </ion-view>\n          ',css:"\n          .custom-thing {\n            background-color: red;\n            color: white;\n            padding: 20px;\n          }\n          ",js:"\n          angular.module('ionic').controller('MyController', function($scope) {\n            console.log('COntrolle running');\n            $scope.doClicker = function() {\n              alert('CLICKER!!!');\n            }\n          })\n          "}])}),e.promise}}]),e}();n.Pages=u},{"../core/core":12,"../core/logger":16,"../core/promise":17}],28:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();if("object"==typeof angular&&angular.module){var o=null;angular.module("ionic.service.push",[]).factory("$ionicPushAction",["$state",function(e){var t=function(){function t(){i(this,t)}return r(t,[{key:"notificationNavigation",value:function(t){var n=!1,i={};try{n=t.additionalData.payload.$state}catch(r){n=!1}try{i=JSON.parse(t.additionalData.payload.$stateParams)}catch(r){i={}}n&&e.go(n,i)}}]),t}();return new t}]).factory("$ionicPush",[function(){return o||(o=new Ionic.Push("DEFER_INIT")),o}]).run(["$ionicPush","$ionicPushAction",function(e,t){e._emitter.on("ionic_push:processNotification",function(e){e&&e.additionalData&&e.additionalData.foreground===!1&&t.notificationNavigation(e)})}])}},{}],29:[function(e,t,n){"use strict";var i=e("./push"),r=e("./push-token");window.Ionic=window.Ionic||{},Ionic.Push=i.Push,Ionic.PushToken=r.PushToken},{"./push":33,"./push-token":32}],30:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("../core/request"),a=e("../core/settings"),s=e("../core/logger"),u=e("./push-token"),c=new a.Settings,l=function(){function e(){i(this,e),this.logger=new s.Logger({prefix:"Ionic Push (dev):"}),this._serviceHost=c.getURL("push"),this._token=!1,this._watch=!1}return r(e,[{key:"getDevToken",value:function(){var e="DEV-xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});return this._token=e,this._token}},{key:"init",value:function(e,t){this._push=e,this._emitter=this._push._emitter;var n=this._token,i=this;n||(n=this.getDevToken());var r={method:"POST",uri:this._serviceHost+"/dev/push",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({dev_token:n})};new o.APIRequest(r).then(function(){var e={registrationId:n};i.logger.info("registered with development push service",n),i._emitter.emit("ionic_push:token",e),"function"==typeof t&&t(new u.PushToken(i._token)),i.watch()},function(e){i.logger.error("error connecting development push service.",e)})}},{key:"checkForNotifications",value:function(){if(!this._token)return!1;var e=this,t={method:"GET",uri:this._serviceHost+"/dev/push/check",headers:{Accept:"application/json","Content-Type":"application/json","X-Ionic-Dev-Token":this._token},json:!0};new o.APIRequest(t).then(function(t){if(t.payload.messages.length>0){var n={message:t.payload.messages[0],title:"DEVELOPMENT PUSH"};e.logger.warn("Ionic Push: Development Push received. Development pushes will not contain payload data."),e._emitter.emit("ionic_push:notification",n)}},function(t){e.logger.error("unable to check for development pushes.",t)})}},{key:"watch",value:function(){this.logger.info("watching for new notifications");var e=this;this._watch||(this._watch=setInterval(function(){e.checkForNotifications()},5e3))}},{key:"halt",value:function(){this._watch&&clearInterval(this._watch)}}]),e}();n.PushDevService=l},{"../core/logger":16,"../core/request":18,"../core/settings":19,"./push-token":32}],31:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this.asleep=!1,this.closed=!1}return r(e,[{key:"wasAsleep",get:function(){return this.asleep}},{key:"wasClosed",get:function(){return this.closed}}]),e}(),a=function(){function e(t){i(this,e),this._raw=t||{},this._raw.additionalData||(this._raw.additionalData={coldstart:!1,foreground:!0}),this._payload=null,this.app=null,this.text=null,this.title=null,this.count=null,this.sound=null,this.image=null}return r(e,[{key:"processRaw",value:function(){this.text=this._raw.message||null,this.title=this._raw.title||null,this.count=this._raw.count||null,this.sound=this._raw.sound||null,this.image=this._raw.image||null,this.app=new o,this._raw.additionalData.foreground||(this.app.asleep=!0),this._raw.additionalData.coldstart&&(this.app.closed=!0),this._raw.additionalData.payload&&(this._payload=this._raw.additionalData.payload)}},{key:"getRawVersion",value:function(){return this._raw}},{key:"toString",value:function(){return"<PushMessage ['"+this.title+"']>"}},{key:"payload",get:function(){return this._payload||{}}}],[{key:"fromPluginJSON",value:function(t){var n=new e(t);return n.processRaw(),n}}]),e}();n.PushMessage=a},{}],32:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{
value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){i(this,e),this._token=t||null}return r(e,[{key:"toString",value:function(){var e=this._token||"null";return"<PushToken ['"+e+"']>"}},{key:"token",set:function(e){this._token=e},get:function(){return this._token}}]),e}();n.PushToken=o},{}],33:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("../core/app"),a=e("../core/settings"),s=e("../core/core"),u=e("../core/logger"),c=e("../core/events"),l=e("../core/request"),f=e("../core/promise"),d=e("./push-token"),h=e("./push-message"),p=e("./push-dev"),g=new a.Settings,v="DEFER_INIT",y=g.getURL("api")+"/api/v1/app/"+g.get("app_id")+"/push",_={invalidateToken:function(){return y+"/invalidate-token"}},m=function(){function e(t){i(this,e),this.logger=new u.Logger({prefix:"Ionic Push:"});var n=new o.App(g.get("app_id"),g.get("api_key"));if(n.devPush=g.get("dev_push"),n.gcmKey=g.get("gcm_key"),!n.id||!n.apiKey)return this.logger.error("no app_id or api_key found. (http://docs.ionic.io/docs/io-install)"),!1;if(s.IonicPlatform.isAndroidDevice()&&!n.devPush&&!n.gcmKey)return this.logger.error("GCM project number not found (http://docs.ionic.io/docs/push-android-setup)"),!1;if(this.app=n,this.registerCallback=!1,this.notificationCallback=!1,this.errorCallback=!1,this._token=!1,this._notification=!1,this._debug=!1,this._isReady=!1,this._tokenReady=!1,this._blockRegistration=!1,this._registered=!1,this._emitter=new c.EventEmitter,t!==v){var r=this;s.IonicPlatform.getMain().onReady(function(){r.init(t)})}}return r(e,[{key:"getStorageToken",value:function(){var e=s.IonicPlatform.getStorage(),t=e.retrieveObject("ionic_io_push_token");return t?new d.PushToken(t.token):null}},{key:"clearStorageToken",value:function(){var e=s.IonicPlatform.getStorage();e.deleteObject("ionic_io_push_token")}},{key:"init",value:function(e){if(this._getPushPlugin(),"undefined"==typeof e&&(e={}),"object"!=typeof e)return this.logger.error("init() requires a valid config object."),!1;var t=this;return e.pluginConfig||(e.pluginConfig={}),s.IonicPlatform.isAndroidDevice()&&(e.pluginConfig.android||(e.pluginConfig.android={}),e.pluginConfig.android.senderId||(e.pluginConfig.android.senderID=t.app.gcmKey)),e.onRegister&&this.setRegisterCallback(e.onRegister),e.onNotification&&this.setNotificationCallback(e.onNotification),e.onError&&this.setErrorCallback(e.onError),this._config=e,this._isReady=!0,this._emitter.emit("ionic_push:ready",{config:this._config}),this}},{key:"addTokenToUser",value:function(e){this._token||this.logger.info("a token must be registered before you can add it to a user."),"object"==typeof e?s.IonicPlatform.isAndroidDevice()?e.addPushToken(this._token,"android"):s.IonicPlatform.isIOSDevice()?e.addPushToken(this._token,"ios"):this.logger.info("token is not a valid Android or iOS registration id. Cannot save to user."):this.logger.info("invalid $ionicUser object passed to $ionicPush.addToUser()")}},{key:"register",value:function(e){this.logger.info("register");var t=this;return this._blockRegistration?(t.logger.info("another registration is already in progress."),!1):(this._blockRegistration=!0,void this.onReady(function(){if(t.app.devPush){var n=new p.PushDevService;t._debugCallbackRegistration(),t._callbackRegistration(),n.init(t,e),t._blockRegistration=!1,t._tokenReady=!0}else t._plugin=PushNotification.init(t._config.pluginConfig),t._plugin.on("registration",function(n){t._blockRegistration=!1,t.token=new d.PushToken(n.registrationId),t._tokenReady=!0,"function"==typeof e&&e(t._token)}),t._debugCallbackRegistration(),t._callbackRegistration();t._registered=!0}))}},{key:"unregister",value:function(){var e=this,t=new f.DeferredPromise,n=null;return s.IonicPlatform.isAndroidDevice()?n="android":s.IonicPlatform.isIOSDevice()&&(n="ios"),n||t.reject("Could not detect the platform, are you on a device?"),e._blockUnregister?(e.logger.info("an unregister operation is already in progress."),t.reject(!1)):(this._plugin&&this._plugin.unregister(function(){},function(){}),new l.APIRequest({uri:_.invalidateToken(e),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({platform:n,token:e.getStorageToken().token})}).then(function(n){e._blockUnregister=!1,e.logger.info("unregistered push token: "+e.getStorageToken().token),e.clearStorageToken(),t.resolve(n)},function(n){e._blockUnregister=!1,e.logger.error(n),t.reject(n)})),t.promise}},{key:"getPayload",value:function(e){return e.payload}},{key:"setRegisterCallback",value:function(e){return"function"!=typeof e?(this.logger.info("setRegisterCallback() requires a valid callback function"),!1):(this.registerCallback=e,!0)}},{key:"setNotificationCallback",value:function(e){return"function"!=typeof e?(this.logger.info("setNotificationCallback() requires a valid callback function"),!1):(this.notificationCallback=e,!0)}},{key:"setErrorCallback",value:function(e){return"function"!=typeof e?(this.logger.info("setErrorCallback() requires a valid callback function"),!1):(this.errorCallback=e,!0)}},{key:"_debugRegistrationCallback",value:function(){function e(e){t.token=new d.PushToken(e.registrationId),t.logger.info("(debug) device token registered: "+t._token)}var t=this;return e}},{key:"_debugNotificationCallback",value:function(){function e(e){t._processNotification(e);var n=h.PushMessage.fromPluginJSON(e);t.logger.info("(debug) notification received: "+n),!t.notificationCallback&&t.app.devPush&&alert(n.text)}var t=this;return e}},{key:"_debugErrorCallback",value:function(){function e(e){t.logger.error("(debug) unexpected error occured."),t.logger.error(e)}var t=this;return e}},{key:"_registerCallback",value:function(){function e(e){return t.token=new d.PushToken(e.registrationId),t.registerCallback?t.registerCallback(t._token):void 0}var t=this;return e}},{key:"_notificationCallback",value:function(){function e(e){t._processNotification(e);var n=h.PushMessage.fromPluginJSON(e);return t.notificationCallback?t.notificationCallback(n):void 0}var t=this;return e}},{key:"_errorCallback",value:function(){function e(e){return t.errorCallback?t.errorCallback(e):void 0}var t=this;return e}},{key:"_debugCallbackRegistration",value:function(){this._config.debug&&(this.app.devPush?this._registered||(this._emitter.on("ionic_push:token",this._debugRegistrationCallback()),this._emitter.on("ionic_push:notification",this._debugNotificationCallback()),this._emitter.on("ionic_push:error",this._debugErrorCallback())):(this._plugin.on("registration",this._debugRegistrationCallback()),this._plugin.on("notification",this._debugNotificationCallback()),this._plugin.on("error",this._debugErrorCallback())))}},{key:"_callbackRegistration",value:function(){this.app.devPush?this._registered||(this._emitter.on("ionic_push:token",this._registerCallback()),this._emitter.on("ionic_push:notification",this._notificationCallback()),this._emitter.on("ionic_push:error",this._errorCallback())):(this._plugin.on("registration",this._registerCallback()),this._plugin.on("notification",this._notificationCallback()),this._plugin.on("error",this._errorCallback()))}},{key:"_processNotification",value:function(e){this._notification=e,this._emitter.emit("ionic_push:processNotification",e)}},{key:"_getPushPlugin",value:function(){var e=this,t=!1;try{t=window.PushNotification}catch(n){e.logger.info("something went wrong looking for the PushNotification plugin")}return e.app.devPush||t||!s.IonicPlatform.isIOSDevice()&&!s.IonicPlatform.isAndroidDevice()||e.logger.error("PushNotification plugin is required. Have you run `ionic plugin add phonegap-plugin-push` ?"),t}},{key:"onReady",value:function(e){var t=this;this._isReady?e(t):t._emitter.on("ionic_push:ready",function(){e(t)})}},{key:"token",set:function(e){var t=s.IonicPlatform.getStorage();e instanceof d.PushToken&&t.storeObject("ionic_io_push_token",{token:e.token}),this._token=e}}]),e}();n.Push=m},{"../core/app":11,"../core/core":12,"../core/events":15,"../core/logger":16,"../core/promise":17,"../core/request":18,"../core/settings":19,"./push-dev":30,"./push-message":31,"./push-token":32}],34:[function(e,t,n){"use strict";function i(e){e=e||{};for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var r in n)n.hasOwnProperty(r)&&("object"==typeof n[r]?e[r]=i(e[r],n[r]):e[r]=n[r])}return e}Object.defineProperty(n,"__esModule",{value:!0}),n.deepExtend=i},{}]},{},[17,18,15,16,20,19,13,12,21,11,14,10,32,31,30,33,29,28,27,26,25,23,24,22,9,8,5,7,6]);